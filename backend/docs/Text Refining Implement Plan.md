## 목표 기능

개선된 텍스트 교정

## 목적

기존 텍스트 교정 로직은 한국어 맞춤법 레벨의 교정만을 수행

테디카드 상품명 및 금융 용어와 같은 `명사`에 대한 교정 능력 부족

STT를 통해 전사된 `노이즈 섞인 텍스트`로부터, 발화자가 의도한 `정확한 카드상품명`을 복원하는 대응력 추가

**일반 사용자들은 정확한 상품명을 몰라 부정확하게 말할 수 있음**

## 개선 방안

1. DB에 정의된 테디카드 카드상품 리스트를 활용

2. STT를 통해 전사된 텍스트 입력

  - 개발 단계에서는 STT를 통해 받아졌다고 가정하고 일반 텍스트로 입력
  - 실제 운영에서는 STT를 통해 받아질 예정

3. 발음 유사성, 불필요한 띄어쓰기, 오탈자 등을 고려하여 정확한 테디카드 상품명으로 복원하여 후속 프로세스에 전달

  - 예시
    - "테니카드 서울 청년라이프" -> "테디카드 서울시 청년인생 설계학교"
    - "테디카드 청렴 주택 단보 대출" -> "테디카드 청년주택 담보대출"

## 고려사항

sLLM을 활용 vs 알고리즘 구현

어느 쪽이 더 나을지?

sLLM의 경우 `kanana-nano-2.1B-insturct` 모델을 활용할 예정

## 구현 방법

본 기능과 관련된 일체 모듈들은 `app/llm/delivery/` 안에 생성되며,

Runpod이 필요할 경우 `app/utils/runpod_connector.py` 활용

DB 연결은 `app/db/scripts/modules` 활용

- 단어사전은 DB 내 `keyword_dictionary` 테이블에서 `id`가 2484 이후의 행 이용

## 전체 흐름

1. STT 전사

사용자가 말한 날것 그대로의 데이터를 받아옵니다. STT가 인식하고 옮기는 과정에서 노이즈(맞춤법 및 띄어쓰기 오류, 발음 오류 등)가 섞일 수 있습니다.

2. 형태소 분석 (Targeting)

작업: morphology_analyzer.py를 실행합니다.

목적: **"교정할 대상을 좁히기 위해서"**입니다.

Why?: 문장 전체를 검색 엔진에 넣으면 정확도가 떨어집니다. "테니카드"라는 **명사(NNP)**만 쏙 뽑아서 검색해야 "테디카드"를 찾을 확률이 높아집니다.

입력: "테니카드로 결제해줘"

출력: ['테니카드(NNP)', '결제(NNG)']

3. 단어 매칭 및 교정 (Vocabulary Matching)

작업: vocabulary_matcher.py를 실행합니다.

목적: 추출된 명사("테니카드")가 우리 DB에 있는 "테디카드"인지 확인하고 바꿔치기합니다.

Why?: 형태소 분석기는 이게 오타인지 모릅니다. 매처(Matcher)가 DB와 대조해서 **"아, 이건 테디카드(유사도 0.92)구나"**라고 판별해줍니다.

4. 최종 문장 생성 및 저장 (Refining & Indexing)

작업: 교정된 단어들을 바탕으로 sLLM이 문맥과 문법 오류를 다듬고, 이를 후속 프로세스에서 활용 가능하도록 반환합니다.

목적: **"검색과 분석을 위해서"**입니다.

활용: 이후 RAG(검색 증강 생성)를 할 때는 이 교정된 텍스트를 검색하게 됩니다. 그래야 "테디카드"라고 검색했을 때 정확하게 걸리기 때문입니다.

5. 테스트

테스트 단계에서는 각 과정의 결과를 출력하여 디버깅이 가능하도록 합니다.

## 프로젝트 분석

**보정 목적**

부정확한/유사한 발음을 보정하기 위함

- 의미 해석이나 의도 추론이 아님
- STT 결과를 고객이 실제로 의도한 표준 텍스트로 복원
- **STT의 구조적 특성**
    
    Whisper는 음소(phoneme) 기반이 아닌 **문맥 기반** 모델
    
    1. 문맥 강제 보정
        - 발화가 불명확할 경우, 존재하는 실제 단어로 강제 치환
        - 의미적으로는 틀려도 문법상 자연스러운 단어를 선택
            - 결제 → 결재
            - 리볼빙 → 리버빙 / 리버린
        
        ⇒ 의미는 잘못되었지만 문법적으로는 문제가 없음
        
    2. 음절 경계 붕괴
        - 연속 발화 시 음절 분리 실패
        - 복합 명사에서 중간 음절 탈락
            - 결제금액 → 결제금앱 / 결제그맥
            - 청구금액 → 청구금앱
    3. 외래어/약어 한글화
        - 알파벳 약어를 한글 발음으로 전사
            - ARS → 에이에스 / 에알에스
            - CVC → 씨비씨 / 시비씨
            - VISA → 비사
    4. 조사/어미 흡수
        - 조사, 종결어미가 앞 단어에 결합
            - 결재안되요
            - 자동이체되요
- **STT 보정 사전 설계 원칙**
    
    **허용 범위**
    
    보정 사전에 들어가는 항목은 다음 조건을 만족해야 함
    
    1. STT가 실제로 출력하는 문자열일 것
    2. 발음 유사성에 기반한 오류일 것
    3. 문맥 없이도 단일 정답으로 수렴할 것
    4. 의미 추론이 개입되지 않을 것
    
    **금지 범위**
    
    다음 유형은 STT 보정 단계에서 제외
    
    - 의미 유의어 치환
        
        (예: 혜택 → 할인, 대출 → 카드론)
        
    - 추론
        
        (예: 안됨 → 승인거절)
        
    - 의도 해석
        
        (예: 왜 안 돼요 → 오류)
        
    
    키워드 추출이 아닌, 텍스트 보정이 되어야 한다